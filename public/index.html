<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Клиенты</title>
</head>
<div class="container">
    <h2 class="pt-5 pb-5 text-center">Список клиентов</h2>
    <div class="btn-container flex items-center pb-5">
        <button type="button" class="btn btn-primary" onClick="GetClients()">Обновить</button>
    </div>
    <table class="table table-condensed table-striped table-bordered" id="table111">
        <thead>
        <tr>
            <th>ID</th>
            <th>Фамилия</th>
            <th>Имя</th>
            <th>Отчество</th>
            <th>Название компании</th>
            <th>Телефон</th>
            <th>Адрес</th>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>
<h1>Клиент</h1>
<form name="insertForm">
    <label>Фамилия</label><br>
    <input type="text" name="clientLastName"/><br><br>
    <label>Имя</label><br>
    <input type="text" name="clientFirstName"/><br><br>
    <label>Отчество</label><br>
    <input type="text" name="clientMiddleName"/><br><br>
    <label>Название компании</label><br>
    <input type="text" name="companyName"/><br><br>
    <label>Телефон</label><br>
    <input type="text" name="clientPhone"/><br><br>
    <label>Адрес</label><br>
    <input type="text" name="clientAddress"/><br><br>
    <button type="submit" id="insert" onclick="GetClients()">Добавить</button>
</form>
<script>
    document.getElementById("insert").addEventListener("click", async function (e) {
        e.preventDefault();
        let form = document.forms["insertForm"];
        let clientLastName = form.clientLastName.value;
        let clientFirstName = form.clientFirstName.value;
        let clientMiddleName = form.clientMiddleName.value;
        let companyName = form.companyName.value;
        let clientPhone = form.clientPhone.value;
        let clientAddress = form.clientAddress.value;
        let accs = {
            last_name: clientLastName,
            first_name: clientFirstName,
            middle_name: clientMiddleName,
            company_name: companyName,
            phone: clientPhone,
            address: clientAddress
        }

        let response = await fetch('/api/createClient', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json;charset=utf-8'
            },
            body: JSON.stringify(accs)
        });

        alert("Готово!");
    });
</script>
<script>
    async function GetClients() {
        const response = await fetch("/api/getAllClients", {
            method: "GET",
            headers: {"Accept": "application/json"}
        });
        console.log(response);
        if (response.ok === true) {
            const users = await response.json();
            let rows = document.querySelector("tbody");
            for (var i = document.getElementById('table111').getElementsByTagName('tr').length - 1; i; i--) {
                document.getElementById('table111').deleteRow(i);
            }

            users.forEach(clients => {
                rows.append(row(clients));
            });
        }
    }

    function row(clients) {
        const tr = document.createElement("tr");
        tr.setAttribute("data-rowid", clients.client_id);

        const cid = document.createElement("td");
        cid.append(clients.client_id);
        tr.append(cid);

        const lastName = document.createElement("td");
        lastName.append(clients.last_name);
        tr.append(lastName);

        const firstName = document.createElement("td");
        firstName.append(clients.first_name);
        tr.append(firstName);

        const middleName = document.createElement("td");
        middleName.append(clients.middle_name);
        tr.append(middleName);

        const compName = document.createElement("td");
        compName.append(clients.company_name);
        tr.append(compName);

        const phone = document.createElement("td");
        phone.append(clients.phone);
        tr.append(phone);

        const address = document.createElement("td");
        address.append(clients.address);
        tr.append(address);

        return tr;
    }

    GetClients();
</script>
</body>
</html>